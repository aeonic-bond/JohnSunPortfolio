<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Card Flip Test</title>
    <link rel="stylesheet" href="../styles.css" />
    <style>
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        color: rgba(255, 255, 255, 0.92);
      }

      .wrap {
        width: min(900px, calc(100% - 40px));
        display: grid;
        gap: 16px;
        justify-items: center;
      }

      .hint {
        opacity: 0.8;
        font-size: 14px;
        text-align: center;
      }

      .scene {
        perspective: 1100px;
      }

      .card {
        width: 320px;
        height: 200px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 1000ms cubic-bezier(0.2, 0.7, 0.2, 1);
        border-radius: 18px;
        cursor: pointer;
        outline: none;
        transform: rotateY(0deg);
      }

      /* Start by showing the back, then flip to the front on load. */
      .card.is-back {
        transform: rotateY(-180deg);
      }

      .side {
        position: absolute;
        inset: 0;
        border-radius: 18px;
        backface-visibility: hidden;
        display: grid;
        place-items: center;
        font-weight: 700;
        letter-spacing: 0.2px;
        box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
        border: 1px solid rgba(255, 255, 255, 0.16);
      }

      .front {
        background: #e0002a; /* red */
      }

      .back {
        background: #ffd400; /* yellow */
        color: rgba(0, 0, 0, 0.86);
        transform: rotateY(-180deg);
      }

      @media (prefers-reduced-motion: reduce) {
        .card {
          transition: none;
        }
      }
    </style>
  </head>
  <body>
    <main class="wrap">
      <div class="hint">
        Shows back first, then flips to front on load. Click/tap for a full
        rotation.
      </div>
      <div class="scene">
        <button
          class="card is-back"
          id="flipCard"
          type="button"
          aria-label="Flip card"
        >
          <div class="side front">FRONT (RED)</div>
          <div class="side back">BACK (YELLOW)</div>
        </button>
      </div>
    </main>

    <script>
      const flipCard = document.getElementById("flipCard");

      const prefersReducedMotion = window.matchMedia(
        "(prefers-reduced-motion: reduce)",
      ).matches;

      function showFrontOnLoad() {
        if (prefersReducedMotion) {
          flipCard.classList.remove("is-back");
          return;
        }
        requestAnimationFrame(() => {
          flipCard.classList.remove("is-back");
        });
      }

      let spinInProgress = false;
      function spin360() {
        if (spinInProgress || prefersReducedMotion) return;
        spinInProgress = true;

        const computed = getComputedStyle(flipCard);
        const matrix = computed.transform;
        let currentDeg = 0;
        if (matrix && matrix !== "none") {
          const match = matrix.match(/^matrix3d\\((.+)\\)$/);
          if (match) {
            const values = match[1].split(",").map((v) => Number(v.trim()));
            const a = values[0];
            const c = values[2];
            currentDeg = Math.round(Math.atan2(c, a) * (180 / Math.PI));
          }
        }

        const animation = flipCard.animate(
          [
            { transform: `rotateY(${currentDeg}deg)` },
            { transform: `rotateY(${currentDeg - 360}deg)` },
          ],
          {
            duration: 1000,
            easing: "cubic-bezier(0.2, 0.7, 0.2, 1)",
          },
        );

        animation.addEventListener("finish", () => {
          flipCard.style.transform = "rotateY(0deg)";
          spinInProgress = false;
        });
        animation.addEventListener("cancel", () => {
          spinInProgress = false;
        });
      }

      flipCard.addEventListener("click", spin360);
      showFrontOnLoad();
    </script>
  </body>
</html>
